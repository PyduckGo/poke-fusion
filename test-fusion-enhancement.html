<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®å¯æ¢¦èåˆæ•ˆæœæµ‹è¯• - å¢å¼ºç‰ˆ</title>
    <style>
        body {
            font-family: 'Press Start 2P', cursive;
            background: #1a1a2e;
            color: #eee;
            padding: 20px;
            text-align: center;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .fusion-section {
            display: inline-block;
            margin: 20px;
            vertical-align: top;
        }
        
        .pokemon-display {
            display: inline-block;
            margin: 10px;
            padding: 10px;
            background: #16213e;
            border: 2px solid #0f3460;
            border-radius: 8px;
        }
        
        .pokemon-display img {
            width: 200px;
            height: 200px;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
        }
        
        .fusion-result {
            margin: 20px;
            padding: 20px;
            background: #0f3460;
            border: 3px solid #e94560;
            border-radius: 12px;
            display: inline-block;
        }
        
        .fusion-result img {
            width: 300px;
            height: 300px;
            image-rendering: pixelated;
            image-rendering: -moz-crisp-edges;
            image-rendering: crisp-edges;
            border: 2px solid #fff;
        }
        
        button {
            font-family: 'Press Start 2P', cursive;
            padding: 15px 30px;
            margin: 10px;
            background: #e94560;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }
        
        button:hover {
            background: #c13651;
        }
        
        .loading {
            display: none;
            color: #e94560;
            font-size: 14px;
            margin: 20px;
        }
        
        .test-cases {
            margin-top: 40px;
            text-align: left;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .test-case {
            margin: 20px 0;
            padding: 15px;
            background: #16213e;
            border-radius: 8px;
        }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <h1>ğŸ® å®å¯æ¢¦èåˆæ•ˆæœæµ‹è¯• - å¢å¼ºç‰ˆ</h1>
        <p>æµ‹è¯•æ–°çš„èåˆç®—æ³•ï¼Œå‚è€ƒ alexonsager çš„å®ç°</p>
        
        <div class="fusion-section">
            <h3>é€‰æ‹©å®å¯æ¢¦è¿›è¡Œèåˆ</h3>
            <div>
                <label>å®å¯æ¢¦1 ID: <input type="number" id="pokemon1" value="1" min="1" max="386"></label>
                <label>å®å¯æ¢¦2 ID: <input type="number" id="pokemon2" value="4" min="1" max="386"></label>
            </div>
            <button onclick="testFusion()">æµ‹è¯•èåˆ</button>
            <button onclick="testRandomFusion()">éšæœºèåˆ</button>
        </div>
        
        <div class="loading" id="loading">èåˆä¸­...</div>
        
        <div id="results" style="display: none;">
            <div class="fusion-result">
                <h3>èåˆç»“æœ</h3>
                <img id="fusedImage" alt="èåˆç»“æœ">
                <p id="fusionInfo"></p>
            </div>
            
            <div class="pokemon-display">
                <h4>å®å¯æ¢¦1</h4>
                <img id="pokemon1Img" alt="å®å¯æ¢¦1">
                <p id="pokemon1Name"></p>
            </div>
            
            <div class="pokemon-display">
                <h4>å®å¯æ¢¦2</h4>
                <img id="pokemon2Img" alt="å®å¯æ¢¦2">
                <p id="pokemon2Name"></p>
            </div>
        </div>
        
        <div class="test-cases">
            <h3>ğŸ§ª æµ‹è¯•ç”¨ä¾‹</h3>
            <div class="test-case">
                <strong>ç»å…¸ç»„åˆæµ‹è¯•ï¼š</strong>
                <button onclick="quickTest(1, 4)">å°ç«é¾™ + æ°å°¼é¾Ÿ</button>
                <button onclick="quickTest(25, 133)">çš®å¡ä¸˜ + ä¼Šå¸ƒ</button>
                <button onclick="quickTest(150, 151)">è¶…æ¢¦ + æ¢¦å¹»</button>
            </div>
            
            <div class="test-case">
                <strong>è·¨ä¸–ä»£æµ‹è¯•ï¼š</strong>
                <button onclick="quickTest(1, 152)">å°ç«é¾™ + èŠè‰å¶</button>
                <button onclick="quickTest(25, 252)">çš®å¡ä¸˜ + æœ¨å®ˆå®«</button>
            </div>
            
            <div class="test-case">
                <strong>ç‰¹æ®Šç»„åˆæµ‹è¯•ï¼š</strong>
                <button onclick="quickTest(143, 131)">å¡æ¯”å…½ + æ‹‰æ™®æ‹‰æ–¯</button>
                <button onclick="quickTest(94, 65)">è€¿é¬¼ + èƒ¡åœ°</button>
            </div>
        </div>
    </div>

    <script type="module">
        // æ¨¡æ‹Ÿå¢å¼ºç‰ˆèåˆå‡½æ•°
        async function enhancedFusion(sprite1Url, sprite2Url) {
            // è¿™é‡Œä½¿ç”¨å®é™…çš„èåˆç®—æ³•
            const response = await fetch('/src/utils/fusion-enhanced.ts');
            const script = await response.text();
            
            // åˆ›å»ºä¸´æ—¶è„šæœ¬æ‰§è¡Œç¯å¢ƒ
            const scriptElement = document.createElement('script');
            scriptElement.textContent = script;
            document.head.appendChild(scriptElement);
            
            // è°ƒç”¨å¢å¼ºç‰ˆèåˆ
            return await EnhancedFusion.fusePokemon(sprite1Url, sprite2Url, {
                preserveShape: true,
                colorTransfer: true,
                edgeSmoothing: true,
                pixelSize: 2
            });
        }

        async function testFusion() {
            const pokemon1Id = document.getElementById('pokemon1').value;
            const pokemon2Id = document.getElementById('pokemon2').value;
            
            await performFusion(pokemon1Id, pokemon2Id);
        }

        async function testRandomFusion() {
            const ids = [1, 4, 25, 133, 150, 151, 152, 252, 386];
            const pokemon1Id = ids[Math.floor(Math.random() * ids.length)];
            const pokemon2Id = ids[Math.floor(Math.random() * ids.length)];
            
            document.getElementById('pokemon1').value = pokemon1Id;
            document.getElementById('pokemon2').value = pokemon2Id;
            
            await performFusion(pokemon1Id, pokemon2Id);
        }

        async function quickTest(id1, id2) {
            document.getElementById('pokemon1').value = id1;
            document.getElementById('pokemon2').value = id2;
            await performFusion(id1, id2);
        }

        async function performFusion(pokemon1Id, pokemon2Id) {
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            
            loading.style.display = 'block';
            results.style.display = 'none';
            
            try {
                const sprite1Url = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemon1Id}.png`;
                const sprite2Url = `https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/${pokemon2Id}.png`;
                
                // è·å–å®å¯æ¢¦åç§°
                const pokemonNames = {
                    1: 'å°ç«é¾™', 4: 'æ°å°¼é¾Ÿ', 25: 'çš®å¡ä¸˜', 133: 'ä¼Šå¸ƒ',
                    150: 'è¶…æ¢¦', 151: 'æ¢¦å¹»', 152: 'èŠè‰å¶', 252: 'æœ¨å®ˆå®«',
                    143: 'å¡æ¯”å…½', 131: 'æ‹‰æ™®æ‹‰æ–¯', 94: 'è€¿é¬¼', 65: 'èƒ¡åœ°',
                    386: 'ä»£æ¬§å¥‡å¸Œæ–¯'
                };
                
                // æ˜¾ç¤ºåŸå§‹å›¾ç‰‡
                document.getElementById('pokemon1Img').src = sprite1Url;
                document.getElementById('pokemon2Img').src = sprite2Url;
                document.getElementById('pokemon1Name').textContent = pokemonNames[pokemon1Id] || `å®å¯æ¢¦ #${pokemon1Id}`;
                document.getElementById('pokemon2Name').textContent = pokemonNames[pokemon2Id] || `å®å¯æ¢¦ #${pokemon2Id}`;
                
                // æ¨¡æ‹Ÿèåˆè¿‡ç¨‹
                setTimeout(() => {
                    // åˆ›å»ºèåˆæ•ˆæœ
                    const canvas = document.createElement('canvas');
                    canvas.width = 512;
                    canvas.height = 512;
                    const ctx = canvas.getContext('2d');
                    
                    // ç»˜åˆ¶èåˆæ•ˆæœ
                    ctx.fillStyle = '#2a2a2a';
                    ctx.fillRect(0, 0, 512, 512);
                    
                    // æ·»åŠ åƒç´ åŒ–æ•ˆæœ
                    ctx.imageSmoothingEnabled = false;
                    
                    // ç»˜åˆ¶å®å¯æ¢¦1çš„è½®å»“
                    ctx.fillStyle = '#ff6b6b';
                    ctx.beginPath();
                    ctx.arc(256, 200, 80, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // ç»˜åˆ¶å®å¯æ¢¦2çš„é¢œè‰²
                    ctx.fillStyle = '#4ecdc4';
                    ctx.beginPath();
                    ctx.arc(256, 312, 80, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // æ·»åŠ èåˆç‰¹å¾
                    ctx.fillStyle = '#ffe66d';
                    ctx.fillRect(200, 180, 112, 20);
                    ctx.fillRect(200, 312, 112, 20);
                    
                    document.getElementById('fusedImage').src = canvas.toDataURL();
                    document.getElementById('fusionInfo').textContent = 
                        `èåˆID: F${String(pokemon1Id).padStart(3, '0')}${String(pokemon2Id).padStart(3, '0')}`;
                    
                    loading.style.display = 'none';
                    results.style.display = 'block';
                }, 1500);
                
            } catch (error) {
                console.error('èåˆå¤±è´¥:', error);
                loading.style.display = 'none';
                alert('èåˆå¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–å®å¯æ¢¦ID');
            }
        }

        // å°†å‡½æ•°æš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸ
        window.testFusion = testFusion;
        window.testRandomFusion = testRandomFusion;
        window.quickTest = quickTest;
    </script>
</body>
</html>
